report_out:
  type: object
  additionalProperties: False
  required:
    - id
    - org_id
    - created_at
    - updated_at
    - user_id
    - user
    - purpose
    - currency
    - amount
    - tax
    - state
    - num_expenses
    - is_manually_flagged
    - is_policy_flagged
    - last_paid_at
    - last_approved_at
    - last_submitted_at
    - seq_num
    - source
    - approvals
    - employee
  properties:
    id:
      $ref: ./fields.yaml#/id_string
    org_id:
      $ref: ./fields.yaml#/org_id
    created_at:
      $ref: ./fields.yaml#/created_at
    updated_at:
      $ref: ./fields.yaml#/updated_at
    user_id:
      $ref: ./fields.yaml#/id_string
    user:
      $ref: ./user.yaml#/user_out_embed
    purpose:
      type: string
      description: purpose for creating the report
      example: Business trip to London
      nullable: True
    currency:
      $ref: ./fields.yaml#/currency
    amount:
      $ref: ./fields.yaml#/amount
    tax:
      type: number
      description: |
        Tax value of the object.
      example: 18.23
      nullable: True
    state:
      type: string
      enum:
        - DRAFT
        - APPROVER_PENDING
        - APPROVER_INQUIRY
        - PAYMENT_PROCESSING
        - APPROVED
        - PAYMENT_PENDING
        - PAID
    num_expenses:
      type: integer
      description: |
        Number of expenses part of this report
      example: 3
    is_verified:
      type: boolean
      nullable: true
      description: |
        Determines whether this report has been verified by a verifier
    settlement_id:
      allOf:
        - $ref: './fields.yaml#/fk_string'
      nullable: true
      example: 'set5nlgnwgwl'
    is_physical_bill_submitted:
      type: boolean
      nullable: true
      description: |
        If physical has been collected for this report
    physical_bill_submitted_at:
      type: string
      format: date-time
      example: '2020-06-11T13:14:55.201598+00:00'
      description: |
        Signifies if and when the physical bill for this report was submitted.
      nullable: true
    is_manually_flagged:
      type: boolean
      description: |
        Determines whether this report was flagged manually
    is_policy_flagged:
      type: boolean
      description: |
        Determines whether this report was flagged from a policy
    is_exported:
      type: boolean
      nullable: true
      description: |
        Determines whether this expense has been exported to external accounting system or not.
    last_paid_at:
      type: string
      format: date-time
      example: '2020-06-11T13:14:55.201598+00:00'
      description: |
        Signifies if and when this report was reimbursed.
      nullable: True
    last_approved_at:
      type: string
      format: date-time
      example: '2020-06-11T13:14:55.201598+00:00'
      description: |
        Signifies if and when this report was approved.
      nullable: True
    last_submitted_at:
      type: string
      format: date-time
      example: '2020-06-11T13:14:55.201598+00:00'
      description: |
        Signifies if and when this report was submitted.
      nullable: True
    seq_num:
      type: string
      description: |
        A unique human readable identifier for the report
      example: 'C/2021/02/R/907'
    source:
      type: string
      description: |
        where was this report object created from
      nullable: True
    approvals:
      type: array
      items:
        $ref: ./report_approval.yaml#/report_approval_out_embed
      description: |
        List of report_approval objects
    employee_id:
      $ref: './fields.yaml#/employee_id'
    employee:
      $ref: './employee.yaml#/employee_out_embed'


spender_report_in:
  type: object
  additionalProperties: false
  required:
    - purpose
  properties:
    id:
      $ref: './fields.yaml#/id_string'
    source:
      $ref: './fields.yaml#/report_source'
    purpose:
      type: string
      description: |
        Indicates purpose of the reports.
      example: '#1: Jun 2020'

report_out_embed:
  type: object
  nullable: true
  additionalProperties: False
  required:
    - id
    - last_approved_at
    - last_submitted_at
    - seq_num
    - title
    - state
    - settlement_id
    - last_paid_at
    - reimbursement_id
    - reimbursement_seq_num
  properties:
    id:
      allOf:
        - $ref: ./fields.yaml#/id_string
      example: rpvgnwlgw34
    last_approved_at:
      type: string
      nullable: true
      format: date-time
      example: '2020-06-11T13:14:55.201598+00:00'
      description: |
        Signifies if and when this report was approved.
    last_submitted_at:
      type: string
      nullable: true
      format: date-time
      example: '2020-06-11T13:14:55.201598+00:00'
      description: |
        Signifies if and when this report was submitted.
    seq_num:
      type: string
      description: |
        A unique human readable identifier for the report
      example: 'C/2021/02/R/907'
    title:
      type: string
      description: purpose for creating the report
      example: Business trip to London
      nullable: True
    state:
      type: string
      enum:
        - DRAFT
        - APPROVER_PENDING
        - APPROVER_INQUIRY
        - PAYMENT_PROCESSING
        - APPROVED
        - PAYMENT_PENDING
        - PAID
    settlement_id:
      type: string
      nullable: true
      maxLength: 255
      description: >
        An unique ID, generated by Fyle, for identifying the Settlement.
    last_paid_at:
      type: string
      nullable: true
      format: date-time
      example: '2020-06-11T13:14:55.201598+00:00'
      description: |
        Signifies if and when this report was reimbursed.
    reimbursement_id:
      type: string
      nullable: true
      maxLength: 255
      description: >
        An unique ID, generated by Fyle, for identifying the Reimbursement.
      example: reimntGt9ju6qP
    reimbursement_seq_num:
      type: string
      nullable: true
      description: |
        A unique, organization wide identifier for a particular reimbursement.<br>
        This id is always prefixed with `P/`.
      example: P/2020/11/29

report_action_in:
  type: object
  additionalProperties: False
  required:
    - id
  properties:
    id:
      type: string
      description: |
        id of report that is to be approved
      example: 'rpa21A2rdj2'

report_action_with_expenses_ids_to_add:
  type: object
  additionalProperties: False
  required:
    - id
    - expense_ids
  properties:
    id:
      type: string
      description: |
        id of report, to which the expenses are to be added
      example: 'rpa21A2rdj2'
    expense_ids:
      type: array
      items:
        allOf:
          - $ref: './fields.yaml#/id_string'
      example: [ 'txelntgwgwll' ]

report_action_with_expenses_ids_to_eject:
  type: object
  additionalProperties: False
  required:
    - id
    - expense_ids
  properties:
    id:
      type: string
      description: |
        id of report, from which the expenses are to be ejected
      example: 'rpa21A2rdj2'
    expense_ids:
      type: array
      items:
        allOf:
          - $ref: './fields.yaml#/id_string'
      example: [ 'txelntgwgwll' ]

report_out_subscriptions:
  type: object
  additionalProperties: false
  required:
    - resource
    - action
    - data
    - reason
  properties:
    resource:
      type: string
      example: 'REPORT'
    action:
      type: string
      enum: ['PARTIALLY_APPROVED', 'SUBMITTED', 'APPROVER_ADDED', 'APPROVER_SENDBACK', 'APPROVED', 'APPROVER_REMOVED', 'PAYMENT_PENDING', 'PAYMENT_PROCESSING', 'PAID', 'COMMENTED', 'EXPENSES_ADDED']
      example: 'APPROVED'
    data:
      allOf:
        - $ref: '#/report_out'
        - type: object
          additionalProperties: False
          properties:
            updated_by_user:
              $ref: './user.yaml#/user_out_embed'
    reason:
      type: string
      example: 'comment given by Approver while approving the report.'