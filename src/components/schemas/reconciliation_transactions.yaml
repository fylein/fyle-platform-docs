reconciliation_transaction_out:
  type: object
  additionalProperties: false
  required:
    - id
    - org_id
    - reconciliation_entry_id
    - corporate_card_id
    - statement_amount
    - statement_merchant
    - matched_expenses_count
    - is_reconciled
    - is_ignored
    - expenses
  properties:
    id:
      $ref: './fields.yaml#/id_string'
      example: rectx8abc123
    org_id:
      $ref: './fields.yaml#/org_id'
    reconciliation_entry_id:
      $ref: './fields.yaml#/id_string'
      example: receabc12345
    corporate_card_id:
      $ref: './fields.yaml#/id_string'
      example: bawownwrng
    statement_line_item_id:
      allOf:
        - $ref: './fields.yaml#/fk_string'
      nullable: true
      example: stliabc123
    expense_ids:
      type: array
      items:
        $ref: './fields.yaml#/id_string'
      example: [ 'txwownwrng', 'txuXDH16HzK' ]
    statement_amount:
      $ref: './fields.yaml#/amount'
      example: 33.45
    statement_merchant:
      type: string
      example: AMexon
    statement_transaction_date:
      allOf:
        - $ref: './fields.yaml#/timestamptz_utc'
      nullable: true
    statement_post_date:
      allOf:
        - $ref: './fields.yaml#/timestamptz_utc'
      nullable: true
    matched_expenses_count:
      type: integer
      example: 3
    expenses:
      type: array
      items:
        $ref: '#/reconciliation_matched_expense_out_embed'
      description: | 
        List of matched expenses. Can be an empty array when there are no expenses.
    is_reconciled:
      type: boolean
      example: false
    is_ignored:
      type: boolean
      example: false
    created_at:
      $ref: './fields.yaml#/created_at'
    updated_at:
      $ref: './fields.yaml#/updated_at'

reconciliation_expense_split_out_embed:
  type: object
  additionalProperties: false
  required:
    - id
    - amount
    - state
    - purpose
  properties:
    id:
      allOf:
        - $ref: './fields.yaml#/id_string'
      example: txwownwrng
    amount:
      allOf:
        - $ref: './fields.yaml#/amount'
      nullable: true
    merchant:
      allOf:
        - $ref: './fields.yaml#/merchant'
      nullable: true
    spent_at:
      allOf:
        - $ref: './fields.yaml#/timestamptz_utc'
      nullable: true
    state:
      type: string
      enum:
        - COMPLETE
        - DRAFT
        - PAID
        - PAYMENT_PROCESSING
        - APPROVER_PENDING
        - PAYMENT_PENDING
        - APPROVED
        - UNREPORTABLE
      description: The state of the Expense.
    file_ids:
      type: array
      items:
        $ref: './fields.yaml#/id_string'
      description: List of file IDs attached to the expense split
      example: ['figwiwpjww', 'figwiwpjwx']
    category:
      allOf:
        - $ref: './fields.yaml#/category_display_name'
      description: Category display name of the split expense
      nullable: true
      example: Travel
    project:
      allOf:
        - $ref: './fields.yaml#/project_display_name'
      description: Project display name of the split expense
      nullable: true
      example: ACME / Expansion
    purpose:
      type: string
      nullable: true
      example: Team lunch

reconciliation_matched_expense_out_embed:
  type: object
  additionalProperties: false
  required:
    - id
    - amount
    - merchant
    - spent_at
    - state
    - file_ids
    - category
    - project
    - purpose
    - splits
  properties:
    id:
      allOf:
        - $ref: './fields.yaml#/id_string'
      example: txuXDH16HzK
    amount:
      allOf:
        - $ref: './fields.yaml#/amount'
      nullable: true
      example: 33.45
    merchant:
      allOf:
        - $ref: './fields.yaml#/merchant'
      nullable: true
      example: AMexon
    spent_at:
      allOf:
        - $ref: './fields.yaml#/timestamptz_utc'
      nullable: true
    state:
      type: string
      enum:
        - COMPLETE
        - DRAFT
        - PAID
        - PAYMENT_PROCESSING
        - APPROVER_PENDING
        - PAYMENT_PENDING
        - APPROVED
        - UNREPORTABLE
      description: The state of the Expense.
    file_ids:
      type: array
      items:
        $ref: './fields.yaml#/id_string'
      description: List of file IDs attached to the expense
      example: ['figwiwpjww', 'figwiwpjwx']
    category:
      allOf:
        - $ref: './fields.yaml#/category_display_name'
      description: Category display name of the expense
      nullable: true
      example: Travel
    project:
      allOf:
        - $ref: './fields.yaml#/project_display_name'
      description: Project display name of the expense
      nullable: true
      example: ACME / Expansion
    purpose:
      type: string
      nullable: true
      example: Team lunch
    splits:
      type: array
      description: List of split expenses. Empty when the expense is not split.
      items:
        $ref: '#/reconciliation_expense_split_out_embed'
