expense_out:
  type: object
  additionalProperties: false
  required:
    - id
    - user_id
    - user
    - org_id
    - created_at
    - updated_at
    - spent_at
    - source
    - merchant
    - currency
    - amount
    - claim_amount
    - policy_amount
    - admin_amount
    - foreign_currency
    - foreign_amount
    - purpose
    - cost_center_id
    - cost_center
    - category_id
    - category
    - project_id
    - project
    - source_account_id
    - source_account
    - tax_amount
    - tax_group_id
    - is_billable
    - is_reimbursable
    - distance
    - distance_unit
    - mileage_calculated_distance
    - mileage_calculated_amount
    - mileage_rate_id
    - mileage_rate
    - mileage_is_round_trip
    - per_diem_rate_id
    - per_diem_rate
    - num_days
    - started_at
    - ended_at
    - travel_classes
    - hotel_is_breakfast_provided
    - locations
    - custom_fields
    - code
    - state
    - seq_num
    - report_id
    - added_to_report_at
    - report
    - is_verified
    - last_verified_at
    - is_receipt_missing_when_required
    - is_exported
    - last_exported_at
    - file_ids
    - files
    - employee
    - is_corporate_card_transaction_auto_matched
    - matched_corporate_card_transaction_ids
    - matched_corporate_card_transactions
    - last_settled_at
  properties:
    id:
      allOf:
        - $ref: './fields.yaml#/id_string'
      example: txwownwrng
    user_id:
      $ref: './fields.yaml#/user_id'
    user:
      $ref: './user.yaml#/user_out_embed'
    org_id:
      $ref: './fields.yaml#/org_id'
    created_at:
      $ref: './fields.yaml#/created_at'
    updated_at:
      $ref: './fields.yaml#/updated_at'
    spent_at:
      allOf:
        - $ref: './fields.yaml#/timestamptz_utc'
      nullable: true
      description: |
        signifies when this expense was made.
        This date cannot be in future.
    source:
      type: string
      description: |
        The name of the client app which is creating the expense.
        if its a thrid party app, it prefixed with TPA_.
        Ex - If you pass SLACK_APP, it will be saved as TPA_SLACK_APP. If not
        passed, source is saved as TPA.
      example: SLACK_APP
    merchant:
      type: string
      maxLength: 255
      nullable: true
      description: |
        String denoting the name of the merchant to which the Expense was made.
      example: Uber
    currency:
      $ref: './fields.yaml#/currency'
    amount:
      type: number
      nullable: true
      description: |
        The amount for which the expense was/will-be fyled.
        The amount will be in the currency that the organization's home currency.<br>

        Note that, this field is calculated from admin_amount, policy_amount, claim_amount.

        if admin_amount is present then this value will be same admin_amount.
        if policy_amount is present then this value will be same policy_amount.
        else this should be same as claim_amount.
      example: 1500
    claim_amount:
      type: number
      nullable: true
      description: |
        The expense amount as claimed by user.
      example: 1984.18
    policy_amount:
      type: number
      nullable: true
      description: |
        The expense amount set by policy.
      example: 1500
    admin_amount:
      type: number
      nullable: true
      description: |
        The expense amount which is modified by admin or approver.
        This could be null if admin or approver has not edited your expense.
      example: null
    foreign_currency:
      $ref: './fields.yaml#/foreign_currency'
    foreign_amount:
      $ref: './fields.yaml#/foreign_amount'
    purpose:
      type: string
      nullable: true
      example: Team lunch
    cost_center_id:
      allOf:
        - $ref: './fields.yaml#/fk_integer'
      nullable: true
      example: 1049
    cost_center:
      $ref: './cost_center.yaml#/cost_center_out_embed'
    category_id:
      allOf:
        - $ref: './fields.yaml#/fk_integer'
      nullable: true
      example: 49058
    category:
      $ref: './category.yaml#/category_out_embed'
    project_id:
      allOf:
        - $ref: './fields.yaml#/fk_integer'
      nullable: true
      example: 92895
    project:
      $ref: './project.yaml#/project_out_embed'
    source_account_id:
      allOf:
        - $ref: './fields.yaml#/fk_string'
      example: acwbl222wlg
    source_account:
      $ref: './account.yaml#/account_out_embed'
    tax_amount:
      type: number
      nullable: true
      description: Tax amount as setup by your organisation.
    tax_group_id:
      allOf:
        - $ref: './fields.yaml#/fk_string'
      nullable: true
    is_billable:
      type: boolean
      nullable: true
      example: true
      description: This fields marks whether a given expense is billable a not.
    is_reimbursable:
      type: boolean
      description: This fields marks whether a given expense is reimbursable a not.
      example: true
    distance:
      type: number
      nullable: true
      description: Actual distance travelled by employee in travel related expenses.
    distance_unit:
      type: string
      nullable: true
      description: Unit of distance travelled.
      enum:
        - KM
        - MILES
        - null
      example: MILES
    mileage_calculated_distance:
      type: number
      nullable: true
      description: Distance compluted by Fyle in mileage expenses.
    mileage_calculated_amount:
      type: number
      nullable: true
      description: Amount compluted by Fyle in mileage expenses.
    mileage_rate_id:
      allOf:
        - $ref: './fields.yaml#/fk_integer'
      nullable: true
      example: 9080
    mileage_rate:
      $ref: './mileage_rate.yaml#/mileage_rate_out_embed'
    mileage_is_round_trip:
      type: boolean
      nullable: true
      description: Flag stating whether this was a round trip or not.
    per_diem_rate_id:
      allOf:
        - $ref: './fields.yaml#/fk_integer'
      nullable: true
      example: 583
    per_diem_rate:
      $ref: './per_diem_rate.yaml#/per_diem_rate_out_embed'
    num_days:
      type: integer
      nullable: true
      description: |
        Specific to per diem related expenses, number of days ofr which per diem claim is made.
      example: 2
    started_at:
      $ref: './fields.yaml#/timestamptz_utc'
    ended_at:
      $ref: './fields.yaml#/timestamptz_utc'
    travel_classes:
      description: |
        This field is applicable only for `Flight`, `Train`, `Bus`, `Taxi` category.
        index 0 holds onward journey class, index 1 holds return journey travel class.
      type: array
      minItems: 0
      maxItems: 2
      items:
        type: string
      example:
        - ECONOMY
        - BUSINESS
    hotel_is_breakfast_provided:
      type: boolean
      nullable: true
      description: |
        This field is applicable for only `Hotel` category.
    locations:
      description: |
        This field will be present for travel related categories.
        For travel between Place A to Place B, this array will contain two items, From location at array index 0 and To location at array index 1.
        For travel between Place A to Place c and stopping at Place B, this
      type: array
      minItems: 0
      maxItems: 10
      items:
        $ref: './fields.yaml#/location'
    custom_fields:
      $ref: './fields.yaml#/custom_fields'
    code:
      type: string
      nullable: true
      description: |
        Id given by external systems like Gmail. To identify whether that entity
        has been already added to Fyle or not.
      example: 'wgjwgo3ihwljnlsww'
    state:
      type: string
      enum:
        - COMPLETE
        - DRAFT
        - PAID
        - PAYMENT_PROCESSING
        - APPROVER_PENDING
        - PAYMENT_PENDING
        - APPROVED
      description: The state of the Expense.
    seq_num:
      type: string
      readOnly: true
      description: |
        This is user visible identifier for an expense.
        This field can be used as reference in UI.
      example: E/2020/10/T/95
    report_id:
      allOf:
        - $ref: './fields.yaml#/fk_string'
      nullable: true
      description: |
        Unique id given by Fyle to identify an Expense Report.
      example: rpvgnwlgw34
    added_to_report_at:
      allOf:
        - $ref: './fields.yaml#/timestamptz_utc'
      nullable: true
      description: |
        signifies when this expense was added to a report.
        If this expense is not added to a report, then this could be null.
    report:
      $ref: './report.yaml#/report_out_embed'
    is_verified:
      type: boolean
      nullable: true
      description: |
        Determines whether this expense has been verified by a verifier.
    last_verified_at:
      allOf:
        - $ref: './fields.yaml#/timestamptz_utc'
      nullable: true
      description: |
        signifies when this expense was verified.
    is_receipt_missing_when_required:
      type: boolean
      nullable: true
      description: |
        Determines whether a receipt is missing for this expense when it is required.
    is_exported:
      type: boolean
      nullable: true
      description: |
        Determines whether this expense has been exported to external accounting system or not.
    last_exported_at:
      allOf:
        - $ref: './fields.yaml#/timestamptz_utc'
      nullable: true
      description:
        signifies when this expense was exported to an external accounting system.
    file_ids:
      type: array
      items:
        $ref: './fields.yaml#/id_string'
      example:
        - figwiwpjww
    files:
      type: array
      items:
        $ref: './file.yaml#/file_out_embed'
#    approver_user_ids:
#      type: array
#      items:
#        $ref: ./fields.yaml#/id_string
#      example:
#        - usge49ielgel
    approvals:
      type: array
      items:
        $ref: ./report_approval.yaml#/report_approval_out_embed
      description: |
        List of report_approval objects
    employee_id:
      $ref: './fields.yaml#/employee_id'
    employee:
      $ref: './employee.yaml#/employee_out_embed'
    is_corporate_card_transaction_auto_matched:
      type: boolean
      example: false
      description: |
        Signifies when this corporate card transaction is auto_matched.
    matched_corporate_card_transaction_ids:
      type: array
      items:
        $ref: './fields.yaml#/id_string'
      description: |
        Holds the corporate card transaction ids which are matched to this expense
      example:
        - btxnwownwrng
    matched_corporate_card_transactions:
      type: array
      items:
        $ref: '#/matched_corporate_card_transaction_out_embed'
    last_settled_at:
      allOf:
        - $ref: './fields.yaml#/timestamptz_utc'
      nullable: true
      description: |
        signifies when this expense was last settled.

expense_in:
  type: object
  additionalProperties: false
  required:
    - claim_amount
    - spent_at
  properties:
    spent_at:
      allOf:
        - $ref: './fields.yaml#/timestamptz_pst'
      description: |
        signifies when this expense was made.
        This date cannot be in future.
    source:
      type: string
      description: |
        The name of the client app which is creating the expense.
        if its a thrid party app, it prefixed with TPA_.
        Ex - If you pass SLACK_APP, it will be saved as TPA_SLACK_APP. If not
        passed, source is saved as TPA.
      example: SLACK_APP
    merchant:
      type: string
      maxLength: 255
      nullable: true
      description: |
        String denoting the name of the vendor to which the Expense was made.
      example: Uber
    foreign_currency:
      $ref: './fields.yaml#/foreign_currency'
    foreign_amount:
      $ref: './fields.yaml#/foreign_amount'
    purpose:
      type: string
      example: Team lunch
    cost_center_id:
      allOf:
        - $ref: './fields.yaml#/fk_integer'
      nullable: true
      example: 1049
    category_id:
      allOf:
        - $ref: './fields.yaml#/fk_integer'
      nullable: true
      example: 49058
    project_id:
      allOf:
        - $ref: './fields.yaml#/fk_integer'
      nullable: true
      example: 92895
    source_account_id:
      allOf:
        - $ref: './fields.yaml#/fk_string'
      example: acwbl222wlg
    tax_amount:
      type: number
      nullable: true
      description: Tax amount as setup by your organisation.
    tax_group_id:
      allOf:
        - $ref: './fields.yaml#/fk_string'
      nullable: true
    is_billable:
      type: boolean
      nullable: true
      example: true
      description: This fields marks whether a given expense is billable a not.
    is_reimbursable:
      type: boolean
      nullable: true
      description: This fields marks whether a given expense is reimbursable a not.
      example: true
    distance:
      type: number
      nullable: true
      description: Actual distance travelled by employee in travel related expenses.
    distance_unit:
      type: string
      nullable: true
      description: Unit of distance travelled.
      enum:
        - KM
        - MILES
        - null
      example: MILES
    started_at:
      $ref: './fields.yaml#/timestamptz_pst'
    ended_at:
      $ref: './fields.yaml#/timestamptz_pst'
    travel_classes:
      description: |
        This field is applicable only for `Flight`, `Train`, `Bus`, `Taxi` category.
        index 0 holds onward journey class, index 1 holds return journey travel class.
      type: array
      minItems: 0
      maxItems: 2
      items:
        type: string
      example:
        - ECONOMY
        - BUSINESS
    hotel_is_breakfast_provided:
      type: boolean
      nullable: true
      description: |
        This field is applicable for only `Hotel` category.
    locations:
      description: |
        This field will be present for travel related categories.
        For travel between Place A to Place B, this array will contain two items, From location at array index 0 and To location at array index 1.
        For travel between Place A to Place c and stopping at Place B, this
      type: array
      minItems: 0
      maxItems: 10
      items:
        $ref: './fields.yaml#/location'
    custom_fields:
      $ref: './fields.yaml#/custom_fields'
      

spender_expense_in:
  type: object
  additionalProperties: false
  required:
    - claim_amount
    - spent_at
  properties:
    id:
      $ref: './fields.yaml#/id_string'
    spent_at:
      $ref: './fields.yaml#/spent_at'
    source:
      $ref: './fields.yaml#/source'
    merchant:
      $ref: './fields.yaml#/merchant'
    foreign_currency:
      $ref: './fields.yaml#/foreign_currency'
    foreign_amount:
      $ref: './fields.yaml#/foreign_amount'
    claim_amount:
      $ref: './fields.yaml#/claim_amount'
    purpose:
      type: string
      example: Team lunch
    cost_center_id:
      allOf:
        - $ref: './fields.yaml#/fk_integer'
      nullable: true
      example: 1049
    category_id:
      allOf:
        - $ref: './fields.yaml#/fk_integer'
      nullable: true
      example: 49058
    project_id:
      allOf:
        - $ref: './fields.yaml#/fk_integer'
      nullable: true
      example: 92895
    source_account_id:
      allOf:
        - $ref: './fields.yaml#/fk_string'
      example: acwbl222wlg
    tax_amount:
      type: number
      nullable: true
      description: Tax amount as setup by your organization.
    tax_group_id:
      allOf:
        - $ref: './fields.yaml#/fk_string'
      nullable: true
    is_billable:
      $ref: './fields.yaml#/foreign_currency'
    is_reimbursable:
      $ref: './fields.yaml#/foreign_currency'
    distance:
      $ref: './fields.yaml#/distance'
    distance_unit:
      $ref: './fields.yaml#/distance_unit'
    started_at:
      $ref: './fields.yaml#/timestamptz_pst'
    ended_at:
      $ref: './fields.yaml#/timestamptz_pst'
    travel_classes:
      $ref: './fields.yaml#/travel_classes'
    locations:
      $ref: './fields.yaml#/locations'
    custom_fields:
      $ref: './fields.yaml#/custom_fields'

admin_expense_in:
  allOf:
    - type: object
      required: [ 'admin_amount', 'user_id' ]
      properties:
        admin_amount:
          $ref: './fields.yaml#/amount'
        user_id:
          allOf:
            - $ref: './fields.yaml#/user_id'
          readOnly: false
    - $ref: '#/expense_in'

expense_out_embed:
  type: object
  required:
    - id
    - currency
    - amount
  properties:
    id:
      allOf:
        - $ref: './fields.yaml#/id_string'
      example: txwownwrng
    currency:
      $ref: './fields.yaml#/currency'
    amount:
      $ref: './fields.yaml#/amount'

matched_expense_out_embed:
  type: object
  nullable: true
  additionalProperties: false
  required:
    - id
    - currency
    - amount
    - spent_at
    - merchant
    - purpose
    - foreign_currency
    - foreign_amount
    - state
    - seq_num
  properties:
    id:
      allOf:
        - $ref: './fields.yaml#/id_string'
      example: txwownwrng
    currency:
      $ref: './fields.yaml#/currency'
    amount:
      $ref: './fields.yaml#/amount'
    spent_at:
      allOf:
        - $ref: './fields.yaml#/timestamptz_utc'
      description: |
        signifies when this expense was made.
        This date cannot be in future.
    merchant:
      type: string
      nullable: true
      maxLength: 255
      description: |
        String denoting the name of the merchant to which the Expense was made.
      example: Uber
    foreign_currency:
      $ref: './fields.yaml#/foreign_currency'
    foreign_amount:
      $ref: './fields.yaml#/foreign_amount'
    purpose:
      type: string
      nullable: true
      example: Team lunch
    state:
      type: string
      enum:
        - COMPLETE
        - DRAFT
        - PAID
        - PAYMENT_PROCESSING
        - APPROVER_PENDING
        - PAYMENT_PENDING
        - APPROVED
      description: The state of the Expense.
    seq_num:
      type: string
      readOnly: true
      description: |
        This is user visible identifier for an expense.
        This field can be used as reference in UI.
      example: E/2020/10/T/95

matched_corporate_card_transaction_out_embed:
  type: object
  required:
    - id
    - corporate_card_id
    - corporate_card_number
  properties:
    id:
      allOf:
        - $ref: './fields.yaml#/id_string'
      example: btxnwownwrng
    corporate_card_id:
      allOf:
        - $ref: './fields.yaml#/id_string'
      example: bawownwrng
    corporate_card_number:
      $ref: './fields.yaml#/card_number'

expense_add_comment_action_in:
  type: object
  required:
    - id
    - comment
  properties:
    id:
      allOf:
        - $ref: './fields.yaml#/id_string'
      example: 'txsjfwlrglw'
    comment:
      type: string
      description: Comment made on the expense.
      example: This is a food expense.
